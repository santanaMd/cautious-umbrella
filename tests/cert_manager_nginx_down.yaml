---
- name: Deploy nginx - teste de certificado
  hosts: "{{ groups['hybrid'][0] }}"
  vars_files:
    - ../../secrets/cert-manager.env.yml
  tasks:

    - name: Remover Pod Nginx
      kubernetes.core.k8s:
        state: absent
        definition:
          apiVersion: v1
          kind: Pod
          metadata:
            name: nginx-pod-test
            namespace: default

    - name: Remover Service para o Pod Nginx
      kubernetes.core.k8s:
        state: absent
        definition:
          apiVersion: v1
          kind: Service
          metadata:
            name: nginx-service-test
            namespace: default

    - name: Remover Ingress para o Nginx
      kubernetes.core.k8s:
        state: absent
        definition:
          apiVersion: networking.k8s.io/v1
          kind: Ingress
          metadata:
            name: nginx-ingress-test
            namespace: default
